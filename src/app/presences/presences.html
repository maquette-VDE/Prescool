<div class="presences-wrapper">

  <!-- =======================================================
       SECTION : Header (Titre + Sous-titre)
       ======================================================= -->
  <header class="presences-page-header">
    <div class="presences-page-header-main">
      <h1 class="presences-title">Pr√©sences</h1>
      <p class="presences-subtitle">
        G√©rez et consultez votre pr√©sentiel.
      </p>
    </div>
    <div class="presences-view-switch">
      <button class="btn-view" [class.active]="currentView === 'dayGridMonth'" (click)="switchToMonth()">Mois</button>
      <button class="btn-view" [class.active]="currentView === 'timeGridWeek'" (click)="switchToWeek()">Semaine</button>
    </div>
  </header>


  <!-- =======================================================
       SECTION : Toolbar (Date + Filtre + Recherche + Actions)
       ======================================================= -->
  <section class="presences-toolbar">

    <!-- ---------- PARTIE GAUCHE : DATE + FILTRE ---------- -->
    <div class="presences-toolbar-left">

      <!-- Pilule : Date principale (dynamique) -->
      <button class="pill pill-date-main" type="button">
        <div class="pill-date-box">
          <span class="pill-date-month-abbr">{{ currentWeek.monthAbbr }}</span>
          <span class="pill-date-day">{{ currentWeek.dayOfMonth }}</span>
        </div>
        <span class="pill-date-meta">
          <span class="pill-date-month">{{ currentWeek.dayOfMonth }} {{ currentWeek.monthName }} {{ currentWeek.yearName }}</span>
          <span class="pill-date-range">{{ currentWeek.startDate }} ‚Äì {{ currentWeek.endDate }}</span>
        </span>
      </button>

      <!-- Pilule : Filtre (statique pour l'instant) -->
      <button class="pill pill-filter" type="button" (click)="openStatusModal(null)">
        Pr√©sent(e) / Absent(e)
        <span class="pill-chevron">‚ñæ</span>
      </button>

    </div>


    <!-- ---------- PARTIE CENTRALE : RECHERCHE ---------- -->
    <div class="presences-toolbar-center">
      <div class="search-input">
        <span class="search-icon">üîç</span>

        <input
          class="search-field"
          type="text"
          placeholder="Rechercher un √©v√©nement..."
          (input)="onSearchChanged($event.target.value)"
        />
      </div>
    </div>


    <!-- ---------- PARTIE DROITE : ACTIONS ---------- -->
    <div class="presences-toolbar-right">
      <button class="btn-secondary" type="button">
        Aujourd‚Äôhui
      </button>

      <!-- üî• ACTION : Ajouter un √©v√©nement -->
      <button class="btn-primary" type="button" (click)="openCreateDialog()">
        + Ajouter un √©v√©nement
      </button>
    </div>

  </section>


  <!-- =======================================================
       SECTION : Calendrier (carte + FullCalendar)
       ======================================================= -->
  <section class="presences-calendar-container">
    <div class="calendar-card">

      <!-- üî• FullCalendar Angular
           IMPORTANT :
           - #calendar : permet √† Angular d'acc√©der au composant
           - deepChangeDetection="true" : recommand√© par la doc
      -->
      <full-calendar
        #calendar
        [options]="calendarOptions"
        [deepChangeDetection]="true"
      ></full-calendar>

    </div>
  </section>
  <!-- =======================================================
       SECTION : Modal Statut de Pr√©sence
       ======================================================= -->
  <div class="status-modal-overlay" *ngIf="statusModal.isOpen" (click)="closeStatusModal()">
    <div class="status-modal-content" (click)="$event.stopPropagation()">
      
      <!-- En-t√™te du modal -->
      <div class="status-modal-header">
        <h2 class="status-modal-title">
          {{ isFilterMode ? 'Filtrer les pr√©sences' : 'Statut de pr√©sence' }}
        </h2>
        <button class="status-modal-close" type="button" (click)="closeStatusModal()">‚úï</button>
      </div>

      <!-- Corps du modal -->
      <div class="status-modal-body">
        
        <!-- Boutons de s√©lection du statut -->
        <div class="status-buttons-group">
          
          <!-- Bouton Pr√©sent(e) -->
          <button 
            class="status-button status-button-present"
            [class.active]="statusModal.selectedStatus === 'present'"
            (click)="selectStatus('present')"
            type="button"
          >
            <span class="status-icon">‚úì</span>
            <span class="status-label">Pr√©sent(e)</span>
          </button>

          <!-- Bouton En retard -->
          <button 
            class="status-button status-button-late"
            [class.active]="statusModal.selectedStatus === 'late'"
            (click)="selectStatus('late')"
            type="button"
          >
            <span class="status-icon">‚è±</span>
            <span class="status-label">En retard</span>
          </button>

          <!-- Bouton Absent(e) -->
          <button 
            class="status-button status-button-absent"
            [class.active]="statusModal.selectedStatus === 'absent'"
            (click)="selectStatus('absent')"
            type="button"
          >
            <span class="status-icon">‚úï</span>
            <span class="status-label">Absent(e)</span>
          </button>

        </div>

        <!-- Champs suppl√©mentaires selon le statut -->
        <div class="status-modal-fields" *ngIf="statusModal.selectedStatus">

          <div *ngIf="statusModal.selectedStatus === 'present'" class="status-field">
            <label class="status-field-label">
              <input type="checkbox" [(ngModel)]="statusModal.depart" />D√©part anticip√©
            </label> 

              <label *ngIf="statusModal.depart" class="status-field-label">
                Heure de d√©part :
                <input type="time" class="status-field-input" [(ngModel)]="statusModal.heureDepart" />
              </label>
          </div>
          
          <!-- Pour "En retard" : champ heure d'arriv√©e -->
          <div *ngIf="statusModal.selectedStatus === 'late'" class="status-field">
            <label class="status-field-label">Heure d'arriv√©e</label>
            <input 
              type="time" 
              class="status-field-input" 
              [(ngModel)]="statusModal.lateTime"
              placeholder="09:00"
            />
          </div>

          <!-- Pour "Absent(e)" et "En retard" : champ raison -->
          <div *ngIf="statusModal.selectedStatus === 'absent' || statusModal.selectedStatus === 'late'" class="status-field">
            <label class="status-field-label">
              {{ statusModal.selectedStatus === 'absent' ? 'Raison de mon absence' : 'Raison de mon retard' }}
            </label>
            <input 
              type="text" 
              class="status-field-input" 
              [(ngModel)]="statusModal.reason"
              [placeholder]="statusModal.selectedStatus === 'absent' ? 'ex: maladie' : 'ex: rendez-vous'"
            />
          </div>

        </div>

      </div>

      <!-- Pied de page du modal -->
      <div class="status-modal-footer">
        <button 
          class="status-modal-btn status-modal-btn-cancel" 
          type="button" 
          (click)="closeStatusModal()"
        >
          Annuler
        </button>
        <button 
          class="status-modal-btn status-modal-btn-confirm"
          [class.disabled]="!statusModal.selectedStatus"
          type="button" 
          (click)="confirmStatus()"
          [disabled]="!statusModal.selectedStatus"
        >
          Terminer
        </button>
      </div>

    </div>
  </div>

  <!-- =======================================================
       SECTION : Modal Suppression d'√âv√©nement
       ======================================================= -->
  <div class="delete-modal-overlay" *ngIf="deleteModal.isOpen" (click)="closeDeleteModal()">
    <div class="delete-modal-content" (click)="$event.stopPropagation()">
      
      <!-- En-t√™te du modal -->
      <div class="delete-modal-header">
        <h2 class="delete-modal-title">Supprimer l'√©v√©nement</h2>
        <button class="delete-modal-close" type="button" (click)="closeDeleteModal()">‚úï</button>
      </div>

      <!-- Corps du modal -->
      <div class="delete-modal-body">
        <p class="delete-modal-message">
          √ätes-vous s√ªr(e) de vouloir supprimer cet √©v√©nement ?
        </p>
        <div class="delete-modal-event-info">
          <span class="delete-modal-event-label">√âv√©nement :</span>
          <span class="delete-modal-event-title">{{ deleteModal.eventTitle }}</span>
        </div>
      </div>

      <!-- Pied de page du modal -->
      <div class="delete-modal-footer">
        <button 
          class="delete-modal-btn delete-modal-btn-cancel" 
          type="button" 
          (click)="closeDeleteModal()"
        >
          Annuler
        </button>
        <button 
          class="delete-modal-btn delete-modal-btn-confirm" 
          type="button" 
          (click)="confirmDelete()"
        >
          Supprimer
        </button>
      </div>

    </div>
  </div>

</div>
